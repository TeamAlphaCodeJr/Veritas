{% extends 'base.html' %}

{% block content %}
<section class="controls">
    <form method="POST" action="/choose">
        <div class="controls-top">
            <div class="dashboard-summary">
                <div class="dash-item">
                    <span class="dash-label">Reliability</span>
                    <label class="switch">
                        <input type="checkbox" checked disabled>
                        <span class="slider round"></span>
                    </label>
                    <span class="dash-value">High Only</span>
                </div>
            </div>
            <button type="button" class="control-toggle" data-target="#sourcesPanel">Select news sources</button>
            <div class="controls-actions">
                <button class="btn accent" type="submit">Apply filters</button>
            </div>
        </div>
        <div id="sourcesPanel" class="panel">
            <div class="sources-grid">
                {% for source in sources %}
                <label class="source-item">
                    <input class="source-checkbox" type="checkbox" name="sources" value="{{ source }}" {% if source in allowed %}checked{% endif %}>
                    <span class="source-name">{{ source }}</span>
                </label>
                {% endfor %}
            </div>
            <div class="quick-filters">
                <div class="filter-group">
                    <button type="button" class="chip" data-presets="conservative">Conservative</button>
                    <button type="button" class="chip" data-presets="liberal">Liberal</button>
                    <button type="button" class="chip" data-presets="center">Center</button>
                </div>
                <div class="filter-group">
                    <button type="button" class="chip" data-presets="us">US</button>
                    <button type="button" class="chip" data-presets="world">World</button>
                </div>
                <div class="filter-actions">
                    <button type="button" class="btn ghost" id="clearButton">Clear</button>
                    <button type="button" class="btn ghost" id="selectAllButton">Select all</button>
                </div>
            </div>
        </div>
    </form>
</section>

<section class="articles">
    <div class="grid">
        {% for article in articles %}
        <article class="card">
            <div class="card-content">
                <h3 class="card-title"><a href="{{ article[1].link }}" target="_blank">{{ article[1].title }}</a></h3>
                <div class="meta">{{ article[1].published }} &middot; <span class="source">{{ article[0] }}</span></div>
                
                <div class="card-metrics">
                    <div class="metric-bias">
                        <span class="metric-label">Bias:</span>
                        {% set bias = source_bias.get(article[0], 'Center') %}
                        <span class="bias-tag {{ bias.lower() }}">{{ bias }}</span>
                    </div>
                    <div class="metric-reliability">
                        <span class="metric-label">Reliability:</span>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 98%"></div>
                        </div>
                        <span class="reliability-score">98%</span>
                    </div>
                </div>

                <a class="read-more" href="{{ article[1].link }}" target="_blank">Read</a>
            </div>
        </article>
        {% endfor %}
    </div>
    <div class="pagination center">
        {% if page > 1 %}
        <a class="page-btn" href="{{ url_for('index', page=page-1) }}">Previous</a>
        {% endif %}
        {% if page < total_pages %}
        <a class="page-btn" href="{{ url_for('index', page=page+1) }}">Next</a>
        {% endif %}
    </div>
</section>

<script>
    document.getElementById('clearButton').addEventListener('click', function() {
        document.querySelectorAll('.source-checkbox').forEach(function(cb) { cb.checked = false; });
    });
    document.getElementById('selectAllButton').addEventListener('click', function() {
        document.querySelectorAll('.source-checkbox').forEach(function(cb) { cb.checked = true; });
    });
    var presets = {
        conservative: ['Fox News - Business', 'Fox News - Politics', 'Wall Street Journal', 'The Hill', 'Bloomberg - Politics'],
        liberal: ['New York Times - Technology', 'Washington Post - Opinions', 'The Guardian - World', 'NPR - Politics'],
        center: ['BBC - World', 'Al Jazeera - Top Stories', 'Reuters - World News', 'NPR - News'],
        us: ['Fox News - Business', 'Fox News - Politics', 'New York Times - Technology', 'Washington Post - Opinions', 'CNN - Top Stories', 'USA Today - News'],
        world: ['BBC - World', 'The Guardian - World', 'Al Jazeera - Top Stories', 'Reuters - World News', 'Associated Press - World']
    };
    document.querySelectorAll('.chip').forEach(function(chip) {
        chip.addEventListener('click', function() {
            var key = chip.getAttribute('data-presets');
            var set = presets[key] || [];
            document.querySelectorAll('.source-checkbox').forEach(function(cb) {
                cb.checked = set.indexOf(cb.value) !== -1;
            });
        });
    });
</script>

{% endblock %}